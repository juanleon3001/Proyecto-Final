-- SECUENCIAS
CREATE SEQUENCE CLIENTES_SEQ 
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE SEQUENCE PRODUCTOS_SEQ 
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE SEQUENCE ESTADOS_SEQ 
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE SEQUENCE PEDIDOS_SEQ 
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

-- CLIENTES
CREATE TABLE CLIENTES (
    ID_CLIENTE NUMBER DEFAULT CLIENTES_SEQ.NEXTVAL,
    NOMBRE VARCHAR2(50) NOT NULL,
    APELLIDO VARCHAR2(50) NOT NULL,
    EMAIL VARCHAR2(100) NOT NULL UNIQUE,
    TELEFONO CHAR(10) NOT NULL UNIQUE,
    DIRECCION VARCHAR2(100),
    CONSTRAINT CLIENTES_PK PRIMARY KEY (ID_CLIENTE)
);

-- PRODUCTOS
CREATE TABLE PRODUCTOS (
    ID_PRODUCTO NUMBER DEFAULT PRODUCTOS_SEQ.NEXTVAL,
    NOMBRE VARCHAR2(100) NOT NULL,
    DESCRIPCION CLOB NOT NULL,
    PRECIO NUMBER(10, 2) NOT NULL CHECK (PRECIO >= 0),
    STOCK NUMBER NOT NULL CHECK (STOCK >= 0),
    CONSTRAINT PRODUCTOS_PK PRIMARY KEY (ID_PRODUCTO)
);

-- ESTADOS
CREATE TABLE ESTADOS (
    ID_ESTADO NUMBER DEFAULT ESTADOS_SEQ.NEXTVAL,
    NOMBRE VARCHAR2(20) NOT NULL UNIQUE,
    CONSTRAINT ESTADOS_PK PRIMARY KEY (ID_ESTADO)
);

-- CARGA DE ESTADOS
INSERT INTO ESTADOS (ID_ESTADO, NOMBRE) VALUES (ESTADOS_SEQ.NEXTVAL, 'Pendiente');
INSERT INTO ESTADOS (ID_ESTADO, NOMBRE) VALUES (ESTADOS_SEQ.NEXTVAL, 'Enviado');
INSERT INTO ESTADOS (ID_ESTADO, NOMBRE) VALUES (ESTADOS_SEQ.NEXTVAL, 'Entregado');
INSERT INTO ESTADOS (ID_ESTADO, NOMBRE) VALUES (ESTADOS_SEQ.NEXTVAL, 'Cancelado');

-- PEDIDOS
CREATE TABLE PEDIDOS (
    ID_PEDIDO NUMBER DEFAULT PEDIDOS_SEQ.NEXTVAL,
    ID_CLIENTE NUMBER NOT NULL,
    TOTAL NUMBER(10,2) NOT NULL,
    FECHA_CREACION TIMESTAMP NOT NULL,
    ID_ESTADO NUMBER NOT NULL,
    CONSTRAINT PEDIDOS_PK PRIMARY KEY (ID_PEDIDO),
    CONSTRAINT FK_CLIENTE_PEDIDO FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTES(ID_CLIENTE),
    CONSTRAINT FK_ESTADO_PEDIDO FOREIGN KEY (ID_ESTADO) REFERENCES ESTADOS(ID_ESTADO)
);

-- PEDIDO_PRODUCTO (relaciÃ³n muchos a muchos)
CREATE TABLE PEDIDO_PRODUCTO (
    ID_PEDIDO NUMBER NOT NULL,
    ID_PRODUCTO NUMBER NOT NULL,
    CANTIDAD NUMBER NOT NULL CHECK (CANTIDAD > 0),
    CONSTRAINT PEDIDO_PRODUCTO_PK PRIMARY KEY (ID_PEDIDO, ID_PRODUCTO),
    CONSTRAINT FK_PEDIDO_PP FOREIGN KEY (ID_PEDIDO) REFERENCES PEDIDOS(ID_PEDIDO),
    CONSTRAINT FK_PRODUCTO_PP FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTOS(ID_PRODUCTO)
);